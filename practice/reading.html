<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#0a0a0f">
    <title>Reading Practice - Yespa√±ol</title>
    <style>
        :root {
            --bg-primary: #0a0a0f;
            --bg-glass: rgba(255, 255, 255, 0.06);
            --bg-glass-hover: rgba(255, 255, 255, 0.1);
            --border-glass: rgba(255, 255, 255, 0.1);
            --text-primary: #f5f5f7;
            --text-secondary: rgba(255, 255, 255, 0.6);
            --text-tertiary: rgba(255, 255, 255, 0.4);
            --accent: #ff6b4a;
            --success: #32d74b;
            --warning: #ffd60a;
            --danger: #ff453a;
            --card-radius: 20px;
            --safe-bottom: env(safe-area-inset-bottom, 0px);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        html, body { height: 100%; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.7;
            -webkit-font-smoothing: antialiased;
        }

        .app-container {
            min-height: 100%;
            padding: 56px 20px calc(100px + var(--safe-bottom));
            max-width: 600px;
            margin: 0 auto;
        }

        .back-btn {
            position: fixed; top: 16px; left: 16px; z-index: 100;
            background: var(--bg-glass); border: 1px solid var(--border-glass);
            border-radius: 12px; padding: 10px 16px; color: var(--text-primary);
            font-size: 0.85rem; text-decoration: none;
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
        }

        .header { text-align: center; margin-bottom: 24px; }
        .header-icon { font-size: 2.5rem; margin-bottom: 8px; }
        .header-title { font-size: 1.5rem; font-weight: 700; }
        .header-subtitle { color: var(--text-secondary); font-size: 0.9rem; }

        /* Level selector */
        .level-selector { display: flex; gap: 8px; margin-bottom: 24px; overflow-x: auto; padding-bottom: 4px; }
        .level-btn {
            flex-shrink: 0; padding: 10px 18px;
            background: var(--bg-glass); border: 1px solid var(--border-glass);
            border-radius: 12px; color: var(--text-secondary);
            font-size: 0.85rem; font-weight: 500; cursor: pointer;
        }
        .level-btn.active { background: var(--accent); color: #000; border-color: var(--accent); }

        /* Passage card */
        .passage-card {
            background: var(--bg-glass);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: var(--card-radius);
            padding: 24px; margin-bottom: 20px;
        }

        .passage-meta {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 16px; padding-bottom: 12px;
            border-bottom: 1px solid var(--border-glass);
        }
        .passage-level {
            font-size: 0.7rem; font-weight: 600; text-transform: uppercase;
            letter-spacing: 0.05em; color: var(--accent);
        }
        .passage-length { font-size: 0.75rem; color: var(--text-tertiary); }

        .passage-title {
            font-size: 1.2rem; font-weight: 600; margin-bottom: 16px;
            color: var(--text-primary);
        }

        .passage-text {
            font-size: 1rem; line-height: 1.8;
            color: var(--text-secondary);
        }
        .passage-text p { margin-bottom: 16px; }
        .passage-text p:last-child { margin-bottom: 0; }

        /* Vocabulary highlights */
        .vocab-word {
            color: var(--accent);
            border-bottom: 1px dotted var(--accent);
            cursor: pointer;
            position: relative;
        }
        .vocab-tooltip {
            position: absolute; bottom: 100%; left: 50%;
            transform: translateX(-50%); padding: 8px 12px;
            background: rgba(0, 0, 0, 0.95); border-radius: 8px;
            font-size: 0.8rem; color: #fff; white-space: nowrap;
            opacity: 0; pointer-events: none; transition: opacity 0.2s;
            z-index: 10;
        }
        .vocab-word:hover .vocab-tooltip,
        .vocab-word:focus .vocab-tooltip { opacity: 1; }

        /* Questions section */
        .questions-section {
            background: var(--bg-glass);
            border: 1px solid var(--border-glass);
            border-radius: var(--card-radius);
            padding: 24px; margin-bottom: 20px;
        }
        .questions-title {
            font-size: 1rem; font-weight: 600; margin-bottom: 20px;
            display: flex; align-items: center; gap: 8px;
        }

        .question { margin-bottom: 24px; }
        .question:last-child { margin-bottom: 0; }
        .question-text { font-size: 0.95rem; margin-bottom: 12px; font-weight: 500; }
        .question-number { color: var(--accent); margin-right: 6px; }

        .options { display: flex; flex-direction: column; gap: 8px; }
        .option-btn {
            width: 100%; text-align: left; padding: 14px 16px;
            background: rgba(255,255,255,0.03); border: 1px solid var(--border-glass);
            border-radius: 12px; color: var(--text-primary);
            font-size: 0.9rem; cursor: pointer; transition: all 0.2s;
        }
        .option-btn:active { transform: scale(0.98); }
        .option-btn.selected { border-color: var(--accent); background: rgba(255, 107, 74, 0.1); }
        .option-btn.correct { border-color: var(--success); background: rgba(50, 215, 75, 0.15); color: var(--success); }
        .option-btn.incorrect { border-color: var(--danger); background: rgba(255, 69, 58, 0.15); color: var(--danger); }
        .option-btn:disabled { cursor: default; }

        /* Results */
        .results-card {
            background: linear-gradient(135deg, var(--bg-glass) 0%, rgba(50, 215, 75, 0.1) 100%);
            border: 1px solid rgba(50, 215, 75, 0.2);
            border-radius: var(--card-radius);
            padding: 24px; text-align: center; display: none;
        }
        .results-card.show { display: block; }
        .results-icon { font-size: 3rem; margin-bottom: 12px; }
        .results-score { font-size: 2rem; font-weight: 700; color: var(--success); margin-bottom: 8px; }
        .results-message { color: var(--text-secondary); margin-bottom: 20px; }

        .btn-row { display: flex; gap: 10px; justify-content: center; }
        .btn {
            padding: 14px 24px; border-radius: 12px;
            font-size: 0.9rem; font-weight: 600;
            border: none; cursor: pointer;
        }
        .btn-primary { background: var(--accent); color: #000; }
        .btn-secondary { background: var(--bg-glass); color: var(--text-primary); border: 1px solid var(--border-glass); }

        /* Passage selector */
        .passage-list { display: flex; flex-direction: column; gap: 12px; }
        .passage-preview {
            background: var(--bg-glass); border: 1px solid var(--border-glass);
            border-radius: 16px; padding: 18px; cursor: pointer;
            transition: all 0.2s;
        }
        .passage-preview:active { transform: scale(0.98); background: var(--bg-glass-hover); }
        .passage-preview-title { font-weight: 600; margin-bottom: 4px; }
        .passage-preview-meta { font-size: 0.8rem; color: var(--text-tertiary); display: flex; gap: 12px; }
        .passage-preview.completed { border-color: rgba(50, 215, 75, 0.3); }
        .passage-preview.completed::after {
            content: '‚úì'; float: right; color: var(--success);
            font-weight: bold; margin-top: -24px;
        }

        /* Translation toggle */
        .translation-toggle {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px 16px; background: rgba(255,255,255,0.03);
            border-radius: 12px; margin-top: 16px;
        }
        .toggle-label { font-size: 0.85rem; color: var(--text-secondary); }
        .toggle-switch {
            width: 48px; height: 28px; background: rgba(255,255,255,0.1);
            border-radius: 14px; position: relative; cursor: pointer;
            transition: background 0.2s;
        }
        .toggle-switch.on { background: var(--accent); }
        .toggle-switch::after {
            content: ''; position: absolute; top: 2px; left: 2px;
            width: 24px; height: 24px; background: #fff;
            border-radius: 12px; transition: transform 0.2s;
        }
        .toggle-switch.on::after { transform: translateX(20px); }

        .translation-text {
            margin-top: 16px; padding: 16px;
            background: rgba(255,255,255,0.03);
            border-radius: 12px; font-style: italic;
            color: var(--text-tertiary); font-size: 0.9rem;
            display: none;
        }
        .translation-text.show { display: block; }
    </style>
</head>
<body>
    <a href="../index.html" class="back-btn">‚Üê Back</a>

    <div class="app-container">
        <header class="header">
            <div class="header-icon">üìñ</div>
            <h1 class="header-title">Reading Practice</h1>
            <p class="header-subtitle">Improve comprehension with real Spanish texts</p>
        </header>

        <div class="level-selector">
            <button class="level-btn active" data-level="beginner">Beginner</button>
            <button class="level-btn" data-level="intermediate">Intermediate</button>
            <button class="level-btn" data-level="advanced">Advanced</button>
        </div>

        <div id="passageList" class="passage-list"></div>
        <div id="passageView" style="display: none;"></div>
    </div>

    <script src="../js/core.js"></script>
    <script src="../js/ui.js"></script>
    <script src="../js/loading.js"></script>
    <script>
        // Reading passages database
        const passages = {
            beginner: [
                {
                    id: 'b1',
                    title: 'Mi Familia',
                    text: `<p>Me llamo Ana y tengo una familia peque√±a. Mi padre se llama Juan y tiene cincuenta a√±os. √âl <span class="vocab-word">trabaja<span class="vocab-tooltip">works</span></span> en un hospital porque es m√©dico.</p>
                    <p>Mi madre se llama Mar√≠a. Ella es profesora de ingl√©s en una escuela. A ella le <span class="vocab-word">encanta<span class="vocab-tooltip">loves</span></span> leer libros.</p>
                    <p>Tengo un hermano <span class="vocab-word">menor<span class="vocab-tooltip">younger</span></span> que se llama Pedro. √âl tiene quince a√±os y le gusta mucho jugar al f√∫tbol.</p>
                    <p>Los domingos, toda la familia <span class="vocab-word">almuerza<span class="vocab-tooltip">has lunch</span></span> junta en casa de mi abuela.</p>`,
                    translation: `My name is Ana and I have a small family. My father's name is Juan and he is fifty years old. He works in a hospital because he is a doctor.\n\nMy mother's name is Mar√≠a. She is an English teacher at a school. She loves reading books.\n\nI have a younger brother named Pedro. He is fifteen years old and he really likes playing soccer.\n\nOn Sundays, the whole family has lunch together at my grandmother's house.`,
                    questions: [
                        { q: '¬øCu√°l es la profesi√≥n del padre de Ana?', options: ['Profesor', 'M√©dico', 'Abogado', 'Ingeniero'], correct: 1 },
                        { q: '¬øQu√© le gusta hacer a la madre?', options: ['Cocinar', 'Bailar', 'Leer', 'Cantar'], correct: 2 },
                        { q: '¬øCu√°ntos a√±os tiene Pedro?', options: ['Diez', 'Doce', 'Quince', 'Veinte'], correct: 2 },
                        { q: '¬øQu√© hace la familia los domingos?', options: ['Van al cine', 'Almuerzan juntos', 'Viajan', 'Trabajan'], correct: 1 }
                    ],
                    wordCount: 95
                },
                {
                    id: 'b2',
                    title: 'Un D√≠a Normal',
                    text: `<p>Todos los d√≠as me <span class="vocab-word">despierto<span class="vocab-tooltip">wake up</span></span> a las siete de la ma√±ana. Primero, me ducho y me visto. Despu√©s, <span class="vocab-word">desayuno<span class="vocab-tooltip">I have breakfast</span></span> con mi familia.</p>
                    <p>A las ocho, salgo de casa y camino a la escuela. Las clases <span class="vocab-word">empiezan<span class="vocab-tooltip">begin</span></span> a las ocho y media.</p>
                    <p>A las dos de la tarde, <span class="vocab-word">vuelvo<span class="vocab-tooltip">I return</span></span> a casa para almorzar. Por la tarde, hago mi tarea y a veces juego con mis amigos.</p>
                    <p>Por la noche, ceno con mi familia y veo la televisi√≥n. Me acuesto a las diez.</p>`,
                    translation: `Every day I wake up at seven in the morning. First, I shower and get dressed. Then, I have breakfast with my family.\n\nAt eight, I leave home and walk to school. Classes begin at eight thirty.\n\nAt two in the afternoon, I return home to have lunch. In the afternoon, I do my homework and sometimes I play with my friends.\n\nAt night, I have dinner with my family and watch television. I go to bed at ten.`,
                    questions: [
                        { q: '¬øA qu√© hora se despierta?', options: ['A las seis', 'A las siete', 'A las ocho', 'A las nueve'], correct: 1 },
                        { q: '¬øC√≥mo va a la escuela?', options: ['En coche', 'En autob√∫s', 'Caminando', 'En bicicleta'], correct: 2 },
                        { q: '¬øQu√© hace por la tarde?', options: ['Duerme', 'Trabaja', 'Hace tarea', 'Estudia m√∫sica'], correct: 2 },
                        { q: '¬øA qu√© hora se acuesta?', options: ['A las nueve', 'A las diez', 'A las once', 'A las doce'], correct: 1 }
                    ],
                    wordCount: 108
                },
                {
                    id: 'b3',
                    title: 'El Mercado',
                    text: `<p>Hoy voy al mercado con mi madre. El mercado est√° muy <span class="vocab-word">cerca<span class="vocab-tooltip">near/close</span></span> de nuestra casa, solo a cinco minutos caminando.</p>
                    <p>En el mercado hay muchas <span class="vocab-word">tiendas<span class="vocab-tooltip">shops/stores</span></span>. Compramos frutas frescas: manzanas, naranjas y pl√°tanos. Tambi√©n compramos verduras: tomates, lechugas y zanahorias.</p>
                    <p>Mi madre <span class="vocab-word">pregunta<span class="vocab-tooltip">asks</span></span> el precio de todo. "¬øCu√°nto cuestan las manzanas?" ‚Äî "Dos euros el kilo, se√±ora."</p>
                    <p>Al final, gastamos veinte euros. <span class="vocab-word">Llevamos<span class="vocab-tooltip">We carry</span></span> las bolsas a casa. ¬°Ahora tenemos comida para toda la semana!</p>`,
                    translation: `Today I go to the market with my mother. The market is very close to our house, only five minutes walking.\n\nAt the market there are many shops. We buy fresh fruits: apples, oranges, and bananas. We also buy vegetables: tomatoes, lettuces, and carrots.\n\nMy mother asks the price of everything. "How much do the apples cost?" ‚Äî "Two euros per kilo, ma'am."\n\nIn the end, we spend twenty euros. We carry the bags home. Now we have food for the whole week!`,
                    questions: [
                        { q: '¬øD√≥nde est√° el mercado?', options: ['Lejos', 'Cerca de casa', 'En el centro', 'En otra ciudad'], correct: 1 },
                        { q: '¬øQu√© frutas compran?', options: ['Fresas y uvas', 'Manzanas y naranjas', 'Peras y melones', 'Sand√≠as'], correct: 1 },
                        { q: '¬øCu√°nto cuestan las manzanas?', options: ['Un euro', 'Dos euros el kilo', 'Tres euros', 'Cinco euros'], correct: 1 },
                        { q: '¬øCu√°nto dinero gastan en total?', options: ['Diez euros', 'Quince euros', 'Veinte euros', 'Treinta euros'], correct: 2 }
                    ],
                    wordCount: 112
                }
            ],
            intermediate: [
                {
                    id: 'i1',
                    title: 'El Cambio Clim√°tico',
                    text: `<p>El cambio clim√°tico es uno de los <span class="vocab-word">desaf√≠os<span class="vocab-tooltip">challenges</span></span> m√°s importantes de nuestro tiempo. Las temperaturas globales han aumentado significativamente en las √∫ltimas d√©cadas.</p>
                    <p>Los cient√≠ficos <span class="vocab-word">advierten<span class="vocab-tooltip">warn</span></span> que si no tomamos medidas urgentes, las consecuencias ser√°n devastadoras. El nivel del mar est√° subiendo, los glaciares se est√°n <span class="vocab-word">derritiendo<span class="vocab-tooltip">melting</span></span>, y los eventos clim√°ticos extremos son cada vez m√°s frecuentes.</p>
                    <p>Sin embargo, hay esperanza. Muchos pa√≠ses est√°n <span class="vocab-word">invirtiendo<span class="vocab-tooltip">investing</span></span> en energ√≠as renovables como la solar y la e√≥lica. Los j√≥venes de todo el mundo est√°n exigiendo acci√≥n clim√°tica.</p>
                    <p>Cada persona puede contribuir: reduciendo el consumo de pl√°stico, usando transporte p√∫blico, y <span class="vocab-word">apoyando<span class="vocab-tooltip">supporting</span></span> pol√≠ticas ambientales.</p>`,
                    translation: `Climate change is one of the most important challenges of our time. Global temperatures have increased significantly in recent decades.\n\nScientists warn that if we don't take urgent measures, the consequences will be devastating. Sea level is rising, glaciers are melting, and extreme weather events are becoming more frequent.\n\nHowever, there is hope. Many countries are investing in renewable energies like solar and wind. Young people around the world are demanding climate action.\n\nEach person can contribute: by reducing plastic consumption, using public transport, and supporting environmental policies.`,
                    questions: [
                        { q: '¬øQu√© est√° pasando con las temperaturas globales?', options: ['Est√°n bajando', 'Est√°n estables', 'Est√°n aumentando', 'No se sabe'], correct: 2 },
                        { q: '¬øQu√© est√° pasando con los glaciares?', options: ['Se est√°n formando', 'Se est√°n derritiendo', 'Est√°n creciendo', 'Est√°n estables'], correct: 1 },
                        { q: '¬øQu√© energ√≠as renovables se mencionan?', options: ['Nuclear y gas', 'Solar y e√≥lica', 'Carb√≥n y petr√≥leo', 'Hidroel√©ctrica'], correct: 1 },
                        { q: '¬øQu√© pueden hacer las personas individualmente?', options: ['Nada', 'Solo votar', 'Reducir pl√°stico y usar transporte p√∫blico', 'Mudarse a otro pa√≠s'], correct: 2 }
                    ],
                    wordCount: 148
                },
                {
                    id: 'i2',
                    title: 'La Siesta Espa√±ola',
                    text: `<p>La siesta es una tradici√≥n espa√±ola que ha <span class="vocab-word">perdurado<span class="vocab-tooltip">endured/lasted</span></span> durante siglos. Consiste en dormir una breve siesta despu√©s del almuerzo, generalmente entre las dos y las cinco de la tarde.</p>
                    <p>Esta costumbre tiene sus ra√≠ces en el clima mediterr√°neo. Durante las horas m√°s calurosas del d√≠a, era <span class="vocab-word">sensato<span class="vocab-tooltip">sensible/wise</span></span> descansar en lugar de trabajar bajo el sol abrasador.</p>
                    <p>Sin embargo, la siesta est√° <span class="vocab-word">desapareciendo<span class="vocab-tooltip">disappearing</span></span> en la Espa√±a moderna. Los horarios laborales m√°s estrictos y el ritmo de vida acelerado hacen dif√≠cil mantener esta tradici√≥n. Muchas tiendas que antes cerraban al mediod√≠a ahora permanecen abiertas.</p>
                    <p>A pesar de esto, los estudios cient√≠ficos <span class="vocab-word">respaldan<span class="vocab-tooltip">support/back up</span></span> los beneficios de la siesta: mejora la memoria, reduce el estr√©s y aumenta la productividad.</p>`,
                    translation: `The siesta is a Spanish tradition that has endured for centuries. It consists of taking a brief nap after lunch, generally between two and five in the afternoon.\n\nThis custom has its roots in the Mediterranean climate. During the hottest hours of the day, it was sensible to rest instead of working under the scorching sun.\n\nHowever, the siesta is disappearing in modern Spain. Stricter work schedules and the accelerated pace of life make it difficult to maintain this tradition. Many shops that used to close at noon now stay open.\n\nDespite this, scientific studies support the benefits of the siesta: it improves memory, reduces stress, and increases productivity.`,
                    questions: [
                        { q: '¬øCu√°ndo se toma tradicionalmente la siesta?', options: ['Por la ma√±ana', 'Despu√©s del almuerzo', 'Por la noche', 'Antes del desayuno'], correct: 1 },
                        { q: '¬øPor qu√© surgi√≥ la tradici√≥n de la siesta?', options: ['Por el fr√≠o', 'Por el calor del mediod√≠a', 'Por la lluvia', 'Por la noche'], correct: 1 },
                        { q: '¬øQu√© est√° pasando con la siesta hoy en d√≠a?', options: ['Es m√°s popular', 'Est√° desapareciendo', 'Es obligatoria', 'No ha cambiado'], correct: 1 },
                        { q: '¬øQu√© dicen los estudios sobre la siesta?', options: ['Es mala para la salud', 'No tiene efectos', 'Mejora la memoria y reduce el estr√©s', 'Causa problemas'], correct: 2 }
                    ],
                    wordCount: 165
                }
            ],
            advanced: [
                {
                    id: 'a1',
                    title: 'El Realismo M√°gico',
                    text: `<p>El realismo m√°gico es un g√©nero literario que <span class="vocab-word">surgi√≥<span class="vocab-tooltip">emerged/arose</span></span> en Latinoam√©rica a mediados del siglo XX. Se caracteriza por la inclusi√≥n de elementos m√°gicos o fant√°sticos en un contexto realista, presentados como si fueran completamente normales.</p>
                    <p>Gabriel Garc√≠a M√°rquez, el escritor colombiano ganador del Premio Nobel, es quiz√°s el m√°ximo <span class="vocab-word">exponente<span class="vocab-tooltip">exponent/representative</span></span> de este g√©nero. Su obra maestra, "Cien a√±os de soledad", narra la historia de la familia Buend√≠a a trav√©s de varias generaciones en el pueblo ficticio de Macondo.</p>
                    <p>En esta novela, lo <span class="vocab-word">sobrenatural<span class="vocab-tooltip">supernatural</span></span> convive con lo cotidiano: los muertos hablan con los vivos, una mujer asciende al cielo mientras tiende la ropa, y una lluvia puede durar a√±os. Sin embargo, los personajes aceptan estos fen√≥menos sin <span class="vocab-word">asombro<span class="vocab-tooltip">astonishment</span></span>.</p>
                    <p>El realismo m√°gico no es simplemente fantas√≠a; es una forma de representar la realidad latinoamericana, donde la historia, la pol√≠tica y las creencias populares se <span class="vocab-word">entrelazan<span class="vocab-tooltip">intertwine</span></span> de maneras que desaf√≠an la l√≥gica occidental.</p>`,
                    translation: `Magical realism is a literary genre that emerged in Latin America in the mid-twentieth century. It is characterized by the inclusion of magical or fantastic elements in a realistic context, presented as if they were completely normal.\n\nGabriel Garc√≠a M√°rquez, the Colombian writer and Nobel Prize winner, is perhaps the greatest exponent of this genre. His masterpiece, "One Hundred Years of Solitude," narrates the history of the Buend√≠a family across several generations in the fictional town of Macondo.\n\nIn this novel, the supernatural coexists with the everyday: the dead speak with the living, a woman ascends to heaven while hanging laundry, and a rain can last for years. However, the characters accept these phenomena without astonishment.\n\nMagical realism is not simply fantasy; it is a way of representing Latin American reality, where history, politics, and popular beliefs intertwine in ways that defy Western logic.`,
                    questions: [
                        { q: '¬øCu√°ndo surgi√≥ el realismo m√°gico?', options: ['Siglo XVIII', 'Siglo XIX', 'Mediados del siglo XX', 'Siglo XXI'], correct: 2 },
                        { q: '¬øQui√©n es el m√°ximo exponente del g√©nero?', options: ['Pablo Neruda', 'Jorge Luis Borges', 'Gabriel Garc√≠a M√°rquez', 'Mario Vargas Llosa'], correct: 2 },
                        { q: '¬øC√≥mo reaccionan los personajes ante lo sobrenatural?', options: ['Con miedo', 'Con asombro', 'Sin asombro, como algo normal', 'Con alegr√≠a'], correct: 2 },
                        { q: '¬øQu√© representa el realismo m√°gico seg√∫n el texto?', options: ['La fantas√≠a pura', 'La ciencia ficci√≥n', 'La realidad latinoamericana', 'La historia europea'], correct: 2 }
                    ],
                    wordCount: 198
                },
                {
                    id: 'a2',
                    title: 'La Inmigraci√≥n y la Identidad',
                    text: `<p>La inmigraci√≥n <span class="vocab-word">plantea<span class="vocab-tooltip">poses/raises</span></span> preguntas fundamentales sobre la identidad. ¬øQu√© significa pertenecer a un lugar? ¬øPuede una persona ser de dos pa√≠ses simult√°neamente? Estas cuestiones se vuelven cada vez m√°s relevantes en nuestro mundo globalizado.</p>
                    <p>Los inmigrantes a menudo experimentan lo que los soci√≥logos llaman "identidad <span class="vocab-word">h√≠brida<span class="vocab-tooltip">hybrid</span></span>". No son completamente de su pa√≠s de origen ni completamente del pa√≠s de acogida. Viven en un espacio intermedio, negociando constantemente entre dos culturas.</p>
                    <p>Esta experiencia puede ser <span class="vocab-word">enriquecedora<span class="vocab-tooltip">enriching</span></span> pero tambi√©n dolorosa. Los hijos de inmigrantes frecuentemente enfrentan presiones contradictorias: en casa se espera que mantengan las tradiciones familiares, mientras que en la escuela y el trabajo deben <span class="vocab-word">asimilarse<span class="vocab-tooltip">assimilate</span></span> a la cultura dominante.</p>
                    <p>Sin embargo, estas identidades m√∫ltiples pueden ser una fortaleza. Las personas biculturales a menudo desarrollan mayor <span class="vocab-word">empat√≠a<span class="vocab-tooltip">empathy</span></span>, flexibilidad cognitiva y habilidades de comunicaci√≥n intercultural ‚Äî competencias cada vez m√°s valiosas en el siglo XXI.</p>`,
                    translation: `Immigration poses fundamental questions about identity. What does it mean to belong to a place? Can a person be from two countries simultaneously? These questions become increasingly relevant in our globalized world.\n\nImmigrants often experience what sociologists call "hybrid identity." They are not completely from their country of origin nor completely from the host country. They live in an intermediate space, constantly negotiating between two cultures.\n\nThis experience can be enriching but also painful. Children of immigrants frequently face contradictory pressures: at home they are expected to maintain family traditions, while at school and work they must assimilate to the dominant culture.\n\nHowever, these multiple identities can be a strength. Bicultural people often develop greater empathy, cognitive flexibility, and intercultural communication skills ‚Äî increasingly valuable competencies in the 21st century.`,
                    questions: [
                        { q: '¬øQu√© es la "identidad h√≠brida"?', options: ['Tener dos pasaportes', 'Vivir entre dos culturas', 'Hablar dos idiomas', 'Tener dos trabajos'], correct: 1 },
                        { q: '¬øQu√© presiones enfrentan los hijos de inmigrantes?', options: ['Solo econ√≥micas', 'Solo laborales', 'Mantener tradiciones y asimilarse', 'Ninguna'], correct: 2 },
                        { q: '¬øQu√© desarrollan las personas biculturales seg√∫n el texto?', options: ['Problemas de identidad', 'Mayor empat√≠a y flexibilidad', 'Confusi√≥n', 'Aislamiento'], correct: 1 },
                        { q: '¬øC√≥mo describe el autor la experiencia de inmigraci√≥n?', options: ['Solo negativa', 'Solo positiva', 'Enriquecedora pero tambi√©n dolorosa', 'Indiferente'], correct: 2 }
                    ],
                    wordCount: 185
                }
            ]
        };

        let currentLevel = 'beginner';
        let currentPassage = null;
        let answers = {};
        let score = 0;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            renderPassageList();

            // Level selector
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentLevel = btn.dataset.level;
                    renderPassageList();
                });
            });
        });

        function renderPassageList() {
            const list = document.getElementById('passageList');
            const view = document.getElementById('passageView');
            const completed = JSON.parse(localStorage.getItem('yespanol_reading_completed') || '[]');

            list.style.display = 'flex';
            view.style.display = 'none';

            list.innerHTML = passages[currentLevel].map(p => `
                <div class="passage-preview ${completed.includes(p.id) ? 'completed' : ''}" onclick="openPassage('${p.id}')">
                    <div class="passage-preview-title">${p.title}</div>
                    <div class="passage-preview-meta">
                        <span>${p.wordCount} words</span>
                        <span>${p.questions.length} questions</span>
                    </div>
                </div>
            `).join('');
        }

        function openPassage(id) {
            currentPassage = passages[currentLevel].find(p => p.id === id);
            answers = {};
            score = 0;

            const list = document.getElementById('passageList');
            const view = document.getElementById('passageView');

            list.style.display = 'none';
            view.style.display = 'block';

            view.innerHTML = `
                <div class="passage-card">
                    <div class="passage-meta">
                        <span class="passage-level">${currentLevel}</span>
                        <span class="passage-length">${currentPassage.wordCount} words</span>
                    </div>
                    <h2 class="passage-title">${currentPassage.title}</h2>
                    <div class="passage-text">${currentPassage.text}</div>

                    <div class="translation-toggle">
                        <span class="toggle-label">Show English translation</span>
                        <div class="toggle-switch" onclick="toggleTranslation(this)"></div>
                    </div>
                    <div class="translation-text" id="translationText">${currentPassage.translation.replace(/\n/g, '<br>')}</div>
                </div>

                <div class="questions-section">
                    <h3 class="questions-title">üìù Comprehension Questions</h3>
                    ${currentPassage.questions.map((q, i) => `
                        <div class="question" id="question-${i}">
                            <div class="question-text"><span class="question-number">${i + 1}.</span> ${q.q}</div>
                            <div class="options">
                                ${q.options.map((opt, j) => `
                                    <button class="option-btn" onclick="selectAnswer(${i}, ${j})">${opt}</button>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}

                    <div style="margin-top: 24px;">
                        <button class="btn btn-primary" onclick="checkAnswers()" style="width: 100%;">Check Answers</button>
                    </div>
                </div>

                <div class="results-card" id="resultsCard">
                    <div class="results-icon">üéâ</div>
                    <div class="results-score" id="resultsScore">0/0</div>
                    <div class="results-message" id="resultsMessage">Great job!</div>
                    <div class="btn-row">
                        <button class="btn btn-secondary" onclick="renderPassageList()">Back to List</button>
                        <button class="btn btn-primary" onclick="openPassage('${id}')">Try Again</button>
                    </div>
                </div>
            `;

            window.scrollTo(0, 0);
        }

        function toggleTranslation(toggle) {
            toggle.classList.toggle('on');
            document.getElementById('translationText').classList.toggle('show');
        }

        function selectAnswer(questionIndex, optionIndex) {
            answers[questionIndex] = optionIndex;

            const questionEl = document.getElementById(`question-${questionIndex}`);
            questionEl.querySelectorAll('.option-btn').forEach((btn, i) => {
                btn.classList.remove('selected');
                if (i === optionIndex) btn.classList.add('selected');
            });
        }

        function checkAnswers() {
            score = 0;
            const total = currentPassage.questions.length;

            currentPassage.questions.forEach((q, i) => {
                const questionEl = document.getElementById(`question-${i}`);
                const buttons = questionEl.querySelectorAll('.option-btn');

                buttons.forEach((btn, j) => {
                    btn.disabled = true;
                    if (j === q.correct) {
                        btn.classList.add('correct');
                    } else if (answers[i] === j) {
                        btn.classList.add('incorrect');
                    }
                });

                if (answers[i] === q.correct) score++;
            });

            // Show results
            const resultsCard = document.getElementById('resultsCard');
            resultsCard.classList.add('show');
            document.getElementById('resultsScore').textContent = `${score}/${total}`;

            const percentage = (score / total) * 100;
            let message = '';
            if (percentage === 100) message = '¬°Perfecto! Excellent comprehension!';
            else if (percentage >= 75) message = '¬°Muy bien! Great understanding!';
            else if (percentage >= 50) message = 'Good effort! Keep practicing.';
            else message = 'Keep reading! You\'ll improve.';
            document.getElementById('resultsMessage').textContent = message;

            // Mark as completed
            if (percentage >= 75) {
                const completed = JSON.parse(localStorage.getItem('yespanol_reading_completed') || '[]');
                if (!completed.includes(currentPassage.id)) {
                    completed.push(currentPassage.id);
                    localStorage.setItem('yespanol_reading_completed', JSON.stringify(completed));
                }
            }

            // Record in profile
            if (typeof Yespanol !== 'undefined') {
                Yespanol.recordAttempt(`reading-${currentPassage.id}`, 'vocabulary', percentage >= 50);
            }

            resultsCard.scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
